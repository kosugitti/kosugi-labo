{
  "hash": "c288053ca1cb810ae000df7fb7f1028c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"tidyverse入門\"\n---\n\n\n\n## tidyverseとは\n\ntidyverseは、データサイエンスのためのRパッケージ集です。一貫した文法でデータ操作ができます。\n\n```r\nlibrary(tidyverse)\n```\n\n## パイプ演算子 |>\n\nパイプ演算子 `|>` は、左側の結果を右側の関数の第1引数に渡します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# これは\nmean(students$score)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 80.3\n```\n\n\n:::\n\n```{.r .cell-code}\n# これと同じ\nstudents$score |> mean()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 80.3\n```\n\n\n:::\n:::\n\n\n複数の操作を連続して行うとき、パイプを使うと読みやすくなります。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# パイプなし（読みにくい）\nround(mean(students$score), 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 80.3\n```\n\n\n:::\n\n```{.r .cell-code}\n# パイプあり（読みやすい）\nstudents$score |> mean() |> round(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 80.3\n```\n\n\n:::\n:::\n\n\n## dplyrの主要な関数\n\n### filter()：行の絞り込み\n\n条件に合う行だけを取り出します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# スコアが80以上\nstudents |> filter(score >= 80)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 5\n     id name  grade score group\n  <int> <chr> <dbl> <dbl> <chr>\n1     2 鈴木      2    82 B    \n2     3 佐藤      4    91 A    \n3     6 渡辺      4    88 B    \n4     8 小林      2    95 B    \n5     9 加藤      4    83 A    \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# グループAかつ3年生\nstudents |> filter(group == \"A\", grade == 3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 5\n     id name  grade score group\n  <int> <chr> <dbl> <dbl> <chr>\n1     1 田中      3    78 A    \n2     7 中村      3    70 A    \n```\n\n\n:::\n:::\n\n\n### select()：列の選択\n\n必要な列だけを取り出します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# name と score だけ\nstudents |> select(name, score)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 2\n   name  score\n   <chr> <dbl>\n 1 田中     78\n 2 鈴木     82\n 3 佐藤     91\n 4 山田     65\n 5 伊藤     74\n 6 渡辺     88\n 7 中村     70\n 8 小林     95\n 9 加藤     83\n10 吉田     77\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# id 以外\nstudents |> select(-id)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 4\n   name  grade score group\n   <chr> <dbl> <dbl> <chr>\n 1 田中      3    78 A    \n 2 鈴木      2    82 B    \n 3 佐藤      4    91 A    \n 4 山田      3    65 B    \n 5 伊藤      2    74 A    \n 6 渡辺      4    88 B    \n 7 中村      3    70 A    \n 8 小林      2    95 B    \n 9 加藤      4    83 A    \n10 吉田      3    77 B    \n```\n\n\n:::\n:::\n\n\n### mutate()：新しい列を作る\n\n計算結果から新しい列を追加します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudents |> mutate(\n  score_centered = score - mean(score),\n  passed = score >= 70\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 7\n      id name  grade score group score_centered passed\n   <int> <chr> <dbl> <dbl> <chr>          <dbl> <lgl> \n 1     1 田中      3    78 A              -2.30 TRUE  \n 2     2 鈴木      2    82 B               1.70 TRUE  \n 3     3 佐藤      4    91 A              10.7  TRUE  \n 4     4 山田      3    65 B             -15.3  FALSE \n 5     5 伊藤      2    74 A              -6.3  TRUE  \n 6     6 渡辺      4    88 B               7.7  TRUE  \n 7     7 中村      3    70 A             -10.3  TRUE  \n 8     8 小林      2    95 B              14.7  TRUE  \n 9     9 加藤      4    83 A               2.70 TRUE  \n10    10 吉田      3    77 B              -3.30 TRUE  \n```\n\n\n:::\n:::\n\n\n### arrange()：並べ替え\n\n指定した列で並べ替えます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# スコア昇順\nstudents |> arrange(score)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 5\n      id name  grade score group\n   <int> <chr> <dbl> <dbl> <chr>\n 1     4 山田      3    65 B    \n 2     7 中村      3    70 A    \n 3     5 伊藤      2    74 A    \n 4    10 吉田      3    77 B    \n 5     1 田中      3    78 A    \n 6     2 鈴木      2    82 B    \n 7     9 加藤      4    83 A    \n 8     6 渡辺      4    88 B    \n 9     3 佐藤      4    91 A    \n10     8 小林      2    95 B    \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# スコア降順\nstudents |> arrange(desc(score))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 5\n      id name  grade score group\n   <int> <chr> <dbl> <dbl> <chr>\n 1     8 小林      2    95 B    \n 2     3 佐藤      4    91 A    \n 3     6 渡辺      4    88 B    \n 4     9 加藤      4    83 A    \n 5     2 鈴木      2    82 B    \n 6     1 田中      3    78 A    \n 7    10 吉田      3    77 B    \n 8     5 伊藤      2    74 A    \n 9     7 中村      3    70 A    \n10     4 山田      3    65 B    \n```\n\n\n:::\n:::\n\n\n### summarize()：集計\n\nデータを集計します。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudents |> summarize(\n  mean_score = mean(score),\n  sd_score = sd(score),\n  n = n()\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 3\n  mean_score sd_score     n\n       <dbl>    <dbl> <int>\n1       80.3     9.41    10\n```\n\n\n:::\n:::\n\n\n### group_by()：グループ化\n\nグループごとに集計できます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudents |>\n  group_by(group) |>\n  summarize(\n    mean_score = mean(score),\n    n = n()\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 3\n  group mean_score     n\n  <chr>      <dbl> <int>\n1 A           79.2     5\n2 B           81.4     5\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstudents |>\n  group_by(grade) |>\n  summarize(\n    mean_score = mean(score),\n    n = n()\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 3\n  grade mean_score     n\n  <dbl>      <dbl> <int>\n1     2       83.7     3\n2     3       72.5     4\n3     4       87.3     3\n```\n\n\n:::\n:::\n\n\n## 組み合わせて使う\n\nパイプで複数の操作をつなげます。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 3年生以上で、グループ別の平均スコアを計算し、降順に並べる\nstudents |>\n  filter(grade >= 3) |>\n  group_by(group) |>\n  summarize(mean_score = mean(score)) |>\n  arrange(desc(mean_score))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 2\n  group mean_score\n  <chr>      <dbl>\n1 A           80.5\n2 B           76.7\n```\n\n\n:::\n:::\n\n\n## tidyrの主要な関数\n\n### pivot_longer()：縦長に変換\n\n複数の列を1つの列にまとめます（ワイド形式 → ロング形式）。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 例：テストの点数データ\nexam_wide <- tibble(\n  name = c(\"田中\", \"鈴木\"),\n  math = c(80, 75),\n  english = c(70, 85),\n  science = c(90, 80)\n)\nexam_wide\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 4\n  name   math english science\n  <chr> <dbl>   <dbl>   <dbl>\n1 田中     80      70      90\n2 鈴木     75      85      80\n```\n\n\n:::\n\n```{.r .cell-code}\n# 縦長に変換\nexam_wide |>\n  pivot_longer(\n    cols = c(math, english, science),\n    names_to = \"subject\",\n    values_to = \"score\"\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  name  subject score\n  <chr> <chr>   <dbl>\n1 田中  math       80\n2 田中  english    70\n3 田中  science    90\n4 鈴木  math       75\n5 鈴木  english    85\n6 鈴木  science    80\n```\n\n\n:::\n:::\n\n\n### pivot_wider()：横長に変換\n\n1つの列を複数の列に展開します（ロング形式 → ワイド形式）。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 例：縦長データ\nexam_long <- tibble(\n  name = rep(c(\"田中\", \"鈴木\"), each = 3),\n  subject = rep(c(\"math\", \"english\", \"science\"), 2),\n  score = c(80, 70, 90, 75, 85, 80)\n)\nexam_long\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  name  subject score\n  <chr> <chr>   <dbl>\n1 田中  math       80\n2 田中  english    70\n3 田中  science    90\n4 鈴木  math       75\n5 鈴木  english    85\n6 鈴木  science    80\n```\n\n\n:::\n\n```{.r .cell-code}\n# 横長に変換\nexam_long |>\n  pivot_wider(\n    names_from = subject,\n    values_from = score\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 4\n  name   math english science\n  <chr> <dbl>   <dbl>   <dbl>\n1 田中     80      70      90\n2 鈴木     75      85      80\n```\n\n\n:::\n:::\n\n\n## 練習問題\n\n`students` データを使って以下を行ってください：\n\n1. スコアが75以上の学生だけを抽出し、スコアの降順で並べる\n2. 各学年（grade）の平均スコアを計算する\n3. スコアの偏差値（平均50、標準偏差10に変換した値）を新しい列として追加する\n\n::: {.callout-tip collapse=\"true\"}\n## 解答例\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 1\nstudents |>\n  filter(score >= 75) |>\n  arrange(desc(score))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7 × 5\n     id name  grade score group\n  <int> <chr> <dbl> <dbl> <chr>\n1     8 小林      2    95 B    \n2     3 佐藤      4    91 A    \n3     6 渡辺      4    88 B    \n4     9 加藤      4    83 A    \n5     2 鈴木      2    82 B    \n6     1 田中      3    78 A    \n7    10 吉田      3    77 B    \n```\n\n\n:::\n\n```{.r .cell-code}\n# 2\nstudents |>\n  group_by(grade) |>\n  summarize(mean_score = mean(score))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 2\n  grade mean_score\n  <dbl>      <dbl>\n1     2       83.7\n2     3       72.5\n3     4       87.3\n```\n\n\n:::\n\n```{.r .cell-code}\n# 3\nstudents |>\n  mutate(\n    deviation = (score - mean(score)) / sd(score) * 10 + 50\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 6\n      id name  grade score group deviation\n   <int> <chr> <dbl> <dbl> <chr>     <dbl>\n 1     1 田中      3    78 A          47.6\n 2     2 鈴木      2    82 B          51.8\n 3     3 佐藤      4    91 A          61.4\n 4     4 山田      3    65 B          33.7\n 5     5 伊藤      2    74 A          43.3\n 6     6 渡辺      4    88 B          58.2\n 7     7 中村      3    70 A          39.0\n 8     8 小林      2    95 B          65.6\n 9     9 加藤      4    83 A          52.9\n10    10 吉田      3    77 B          46.5\n```\n\n\n:::\n:::\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}